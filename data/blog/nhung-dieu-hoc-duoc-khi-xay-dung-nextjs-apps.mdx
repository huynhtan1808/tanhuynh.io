---
title: 'Nhá»¯ng Ä‘iá»u mÃ¬nh Ä‘Ã£ há»c Ä‘Æ°á»£c khi xÃ¢y dá»±ng Next.js Apps'
publishedAt: '2021-06-01'
summary: 'CSS Modules, Font Loading, Polyfills, Dynamic Imports, MDX, and more!'
image: '/static/images/hoc-css-animations-bang-vi-du/banner.png'
---

MÃ¬nh Ä‘Ã£ dÃ nh ráº¥t nhiá»u thá»i gian trong 4 thÃ¡ng qua Ä‘á»ƒ táº¡o á»©ng dá»¥ng [Next.js](https://nextjs.org/) cho cáº£ cÃ´ng viá»‡c vÃ  cÃ¡ nhÃ¢n.

- MÃ¬nh Ä‘Ã£ chuyá»ƒn trang cÃ¡ nhÃ¢n cá»§a mÃ¬nh tá»« Wordpress sang Next.js + MDX.
- Trang web cá»§a GET Express Ä‘ang Ä‘Æ°á»£c xÃ¢y dá»±ng láº¡i vá»›i Next.js.

Trong suá»‘t quÃ¡ trÃ¬nh Ä‘Ã³, MÃ¬nh Ä‘Ã£ thá»±c sá»± fall in â¤  with Next.js vÃ  há»‡ sinh thÃ¡i cá»§a nÃ³.
ÄÃ¢y lÃ  má»™t sá»‘ Ä‘iá»u MÃ¬nh Ä‘Ã£ há»c Ä‘Æ°á»£c.

## CSS Modules

MÃ¬nh Ä‘Ã£ lÃ m viá»‡c vá»›i CSS, Sass, CSS-in-JS vÃ  bÃ¢y giá» lÃ  CSS Modules. 
Äá»‘i vá»›i háº§u háº¿t cÃ¡c á»©ng dá»¥ng, MÃ¬nh khuyÃªn báº¡n nÃªn sá»­ dá»¥ng CSS Modules.

CSS Modules ngÄƒn cháº·n xung Ä‘á»™t Ä‘áº·t tÃªn vÃ  giÃºp báº¡n khÃ´ng táº£i quÃ¡ nhiá»u kiá»ƒu. ChÃºng Ä‘Æ°á»£c [tÃ­ch há»£p trá»±c tiáº¿p vÃ o Next.js], giÃºp báº¡n dá»… dÃ ng báº¯t Ä‘áº§u

## Font Loading

Báº±ng cÃ¡ch sá»­ dá»¥ng `@font-face` káº¿t há»£p vá»›i thuá»™c tÃ­nh `font-display`, MÃ¬nh cÃ³ thá»ƒ ngÄƒn cháº·n FOUT (Flash of Unstyled Text) vÃ  FOIT (Flash of Invisible Text).

```css
@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-weight: 100 900;
  font-display: optional;
  src: url(/fonts/inter-var-latin.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA,
    U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215,
    U+FEFF, U+FFFD;
}
```
HÆ¡n ná»¯a, MÃ¬nh cÃ³ thá»ƒ [táº£i trÆ°á»›c](https://web.dev/preload-critical-assets/) tá»‡p font chá»¯ Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a trong pháº§n Head cá»§a Document.

```js:pages/_document.js
class MyDocument extends Document {
  render() {
    return (
      <Html lang="en">
        <Head>
          <link
            rel="preload"
            href="/fonts/inter-var-latin.woff2"
            as="font"
            type="font/woff2"
            crossOrigin="anonymous"
          />
        </Head>
        <body>
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }
}

export default MyDocument;
```
**Cáº­p nháº­t**: Äá»ƒ biáº¿t thÃªm thÃ´ng tin, hÃ£y xem [Font chá»¯ Web vÃ o nÄƒm 2021](https://tanhuynh.io/blog/web-fonts-nam-2021).

## Dynamic Imports and Testing

CÃ³ kháº£ nÄƒng khi scaling á»©ng dá»¥ng Next.js, báº¡n sáº½ muá»‘n sá»­ dá»¥ng má»™t External Package mÃ  khÃ´ng hoáº¡t Ä‘á»™ng tá»‘t server-side rendered. Vá»›i mÃ¬nh thÃ¬ package nÃ y lÃ  [react-select](https://react-select.com/).

Khi SSR thÃ nh pháº§n nÃ y, nÃ³ chá»‰ Ä‘Æ¡n giáº£n lÃ  khÃ´ng hoáº¡t Ä‘á»™ng trong Safari. Cho Ä‘áº¿n khi lá»—i Ä‘Ã³ Ä‘Æ°á»£c sá»­a, MÃ¬nh cáº§n má»™t giáº£i phÃ¡p thay tháº¿. 
Nhá» vÃ o Next's [Dynamic Imports](https://nextjs.org/docs/#dynamic-import), tháº­t dá»… dÃ ng import component vÃ  táº¯t SSR.

```jsx
import dynamic from 'next/dynamic';

const ReactSelectNoSSR = dynamic(() => import('../components/select'), {
  ssr: false
});

export default () => (
  <>
    <Header />
    <ReactSelectNoSSR />
    <Footer />
  </>
);
```
Khi má»i thá»© hoáº¡t Ä‘á»™ng á»•n, chÃºng ta cÃ³ thá»ƒ thÃªm loading placeholder Ä‘á»ƒ lÃ m tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng tá»‘t hÆ¡n.

```jsx
const ReactSelectNoSSR = dynamic(() => import('../components/select'), {
  loading: () => <Input />,
  ssr: false
});
```
Tuyá»‡t vá»i ğŸ‰  ok, giá» lÃ m sao Ä‘á»ƒ test Ä‘Ã¢y?

MÃ¬nh hay dÃ¹ng [Jest](https://jestjs.io/), má»™t testing libary. Há»— trá»£ Dynamic Import do Next.js cung cáº¥p **khÃ´ng cho** tháº¥y cÃ¡ch táº£i trÆ°á»›c cÃ¡c components Ä‘Æ°á»£c dynamic import trong mÃ´i trÆ°á»ng cá»§a Jest. Tuy nhiÃªn, nhá» [jest-next-dynamic](https://github.com/FormidableLabs/jest-next-dynamic), chÃºng ta cÃ³ thá»ƒ hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ tree component thay vÃ¬ loading placeholder. Ngon lÃ nh!

Báº¡n sáº½ cáº§n add [babel-plugin-dynamic-import-node](https://www.npmjs.com/package/babel-plugin-dynamic-import-node) vÃ o `.babelrc`.

```js:.babelrc
{
  "plugins": ["babel-plugin-dynamic-import-node"]
}
```

Then, you can use `preloadAll()` to render the component instead of the loading placeholder.

```jsx
import preloadAll from 'jest-next-dynamic';
import ReactSelect from './select';

beforeAll(async () => {
  await preloadAll();
});
```
## MDX

[Portfolio cá»§a mÃ¬nh](https://github.com/tanhuynh1808/tanhuynh.io) Ä‘Ã£ thay Ä‘á»•i khÃ¡ nhiá»u tá»« khi chá»‰ lÃ  trang HTML & CSS tÄ©nh. Sau Ä‘Ã³, mÃ¬nh Ä‘á»•i sang dÃ¹ng [Wordpress](https://wordpress.com/) 
Ä‘á»ƒ tiá»‡n trong viá»‡c quáº£n lÃ½ ná»™i dung. Má»i thá»© ráº¥t á»•n cho Ä‘áº¿n khi mÃ¬nh muá»‘n tÃ¹y Ã½ thay Ä‘á»•i toÃ n bá»™ giao diá»‡n Ä‘á»ƒ thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng khi Ä‘á»c blog cá»§a mÃ¬nh hÆ¡n, Ä‘á»“ng thá»i Ä‘á»ƒ mÃ¬nh luyá»‡n táº­p code Javascript, cho nÃªn mÃ¬nh 
Ä‘Ã£ chuyá»ƒn sang Next.js vÃ  MDX.

Vá»›i [MDX](https://github.com/mdx-js/mdx), mÃ¬nh cÃ³ thá»ƒ sá»­ dá»¥ng JSX components ngay trong Markdown má»™t cÃ¡c dá»… dÃ ng. Vá»›i cÃ¡c nÃ y, náº¿u nhÆ° mÃ¬nh muá»‘n tÃ¹y chá»‰nh má»™t cÃ¡i gÃ¬ Ä‘Ã³ thÃ¬ má»i thá»© Ä‘Æ¡n giáº£n nhÆ° lÃ  import má»™t React Component váº­y.

## Link Prefetching

Äá»ƒ tá»‘i Ä‘a hÃ³a performance, báº¡n cÃ³ thá»ƒ dÃ¹ng `prefetch` [attribute](https://nextjs.org/docs#prefetching-pages) trÃªn Next's `<link>` component. Äiá»u nÃ y sáº½ giÃºp cho trang táº£i ngay láº­p tá»©c.
Ká»ƒ tá»« Next.js 8, `prefetch` sá»­ dá»¥ng `<link rel = "preload">` thay vÃ¬ tháº» `<script>`. NÃ³ cÅ©ng chá»‰ báº¯t Ä‘áº§u tÃ¬m náº¡p trÆ°á»›c sau khi táº£i vá» Ä‘á»ƒ cho phÃ©p trÃ¬nh duyá»‡t quáº£n lÃ½ tÃ i nguyÃªn.

```jsx
<Link prefetch href="/">
  <a>Home</a>
</Link>
```

## Polyfills

Next.js há»— trá»£ IE11 vÃ  táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i (Edge, Firefox, Chrome, Safari, Opera).
Tuy nhiÃªn, cÃ³ thá»ƒ mÃ£ cá»§a riÃªng báº¡n hoáº·c cÃ¡c pháº§n phá»¥ thuá»™c NPM bÃªn ngoÃ i cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng khÃ´ng Ä‘Æ°á»£c há»— trá»£ trong trÃ¬nh duyá»‡t má»¥c tiÃªu cá»§a báº¡n. Trong trÆ°á»ng há»£p nÃ y,
báº¡n sáº½ cáº§n [thÃªm polyfills](https://nextjs.org/docs/basic-features/supported-baries-features#custom-polyfills).

Báº¡n sáº½ cáº§n thÃªm top-level import cho polyfill cá»¥ thá»ƒ mÃ  báº¡n cáº§n trong Custom `<App>` hoáº·c component riÃªng láº».

```js:pages/_app.js

// Add your polyfills here or at the component level.
// For example...
// import 'resize-observer-polyfill'

function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />
}

export default MyApp
```
## Vercel

[Vercel](https://vercel.com) lÃ  cÃ¡ch ** dá»… nháº¥t Ä‘á»ƒ triá»ƒn khai á»©ng dá»¥ng ** mÃ  mÃ¬nh tá»«ng sá»­ dá»¥ng.
Báº¯t Ä‘áº§u cá»±c kÃ¬ dá»… dÃ ng vÃ  GitHub integration cá»§a há» sáº½ tá»± Ä‘á»™ng triá»ƒn khai á»©ng dá»¥ng cá»§a báº¡n theo cÃ¡c yÃªu cáº§u pull request vÃ  cÃ³ link
Ä‘á»ƒ báº¡n xem láº¡i cÃ¡c thay Ä‘á»•i. Náº¿u má»i thá»© cÃ³ váº» tá»‘t, nÃ³ sáº½ deploy thÃ nh prod khi PR Ä‘Æ°á»£c merged. ÄÆ¡n giáº£n nhá»‰.

Há»‡ sinh thÃ¡i Vercel hoáº¡t Ä‘á»™ng cÃ¹ng nhau ráº¥t tá»‘t. [Dá»‹ch vá»¥ Domain](https://vercel.com/domains) cá»§a há» cho phÃ©p báº¡n
Ä‘á»ƒ mua tÃªn miá»n tá»« command line. MÃ¬nh chÆ°a bao giá» cÃ³ thá»ƒ chuyá»ƒn tá»« má»™t Ã½ tÆ°á»Ÿng thÃ nh má»™t á»©ng dá»¥ng thá»±c sá»±, Ä‘Æ°á»£c triá»ƒn khai
Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn má»™t domain nhanh Ä‘áº¿n nhÆ° váº­y. Báº£n thÃ¢n mÃ¬nh tháº­m chÃ­ Ä‘Ã£ cÃ³ thá»ƒ thiáº¿t láº­p chuyá»ƒn tiáº¿p email cho domain cá»§a mÃ¬nh vÃ  táº¡o `hi@tanhuynh.io` báº±ng cÃ¡ch sá»­ dá»¥ng [randomvmx](https://improvmx.com/) ğŸ‰

## Where To Get Help

Há»— trá»£ tá»« cá»™ng Ä‘á»“ng Next.js vÃ  Vercel tháº­t sá»± _fantastic_. Há» pháº£n há»“i ráº¥t nhanh tá»« email, cho tá»›i báº¥t ká»³ hÃ¬nh thá»©c liÃªn há»‡ khÃ¡c. 
PhÆ°Æ¡ng phÃ¡p Æ°a thÃ­ch cá»§a mÃ¬nh luÃ´n lÃ  [Tháº£o luáº­n trÃªn GitHub](https://github.com/zeit/next.js/discussions). Táº¥t cáº£
cÃ¢u há»i vÃ  cÃ¢u tráº£ lá»i Ä‘Æ°á»£c láº­p chá»‰ má»¥c, cÃ³ thá»ƒ tÃ¬m kiáº¿m vÃ  dá»… dÃ ng tÃ¬m tháº¥y. [HÆ°á»›ng dáº«n](https://nextjs.org/learn/) vÃ  [docs](https://nextjs.org/docs) cá»§a há» cÅ©ng ráº¥t hay vÃ  Ä‘Æ°á»£c viáº¿t ráº¥t tá»‘t, ráº¥t dá»… hiá»ƒu.




